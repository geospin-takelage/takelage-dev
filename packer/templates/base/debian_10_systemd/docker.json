{
  "variables": {
    "image_version": "{{ image_version }}",
    "image_name": "{{ image_name }}",
    "base_image": "{{ base_image }}",
    "target_repo": "{{ target_repo }}"
  },
  "builders":[
    {
      "type": "docker",
      "image": "{{ user `base_image` }}",
      "export_path": "images/{{ user `image_name` }}-{{ user `image_version` }}.tar",
      "run_command": [ "-d", "-i", "-t", "--name", "{{user `image_name`}}", "{{.Image}}", "/bin/bash" ]
    }
  ],
  "provisioners":
  [
    {
      "type": "shell",
      "script": "templates/base/debian_10_systemd/bin/install-debian.bash"
    }
  ],
  "post-processors": [
    [
      {
        "type": "docker-import",
        "repository": "{{ user `target_repo` }}/{{ user `image_name` }}",
        "tag": "{{ user `image_version` }}",
        "keep_input_artifact": true,
        "changes": [
          "WORKDIR /root",
          "ENV DEBIAN_FRONTEND=noninteractive",
          "ENV LANG=C.UTF-8",
          "ENV SUPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
          "ENV PATH=/usr/local/bin:/usr/bin:/bin",
          "CMD [\"/lib/systemd/systemd\"]"
        ]
      }
    ]
  ]
}

